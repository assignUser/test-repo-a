name: WebDav
on:
  push:
  workflow_dispatch:

jobs:
  # test-linux:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - run: | 
  #         sudo apt update && sudo apt install davfs2
  #         mkdir nightly
  #         sudo bash -c 'echo "https://nightly.wujciak.de:8080 ${{ secrets.ASF_USER }} ${{ secrets.ASF_KEY }}" >> /etc/davfs2/secrets'
  #         sudo mount -t davfs https://nightly.wujciak.de:8080 nightly -o rw
  #         ls -la nightly
  test-mac:
    runs-on: macos-latest
    steps:
      #- run: brew install --cask macfuse
      #- run: curl https://rclone.org/install.sh | sudo bash
      - run: mkdir nightly
      - name: Configure rclone
        shell: expect
        env:
          PW: ${{ secrets.ASF_KEY }}
          USER: ${{ secrets.ASF_USER }}
        run: |
          spawn /sbin/mount_webdav -i -s -v nightly https://nightly.wujciak.de:8080/  ${{ github.workspace }}/nightly
          expect "name:" {
          send "$USER\r"
          }
          expect timeout {
          exit
          } "word:" {
          send "$PW\r"
          exp_continue
          }
          # echo "[nightly]
          # type = webdav
          # url = https://nightly.wujciak.de:8080
          # vendor = other
          # user = $USER
          # pass = $(rclone obscure $PW)" > nightly.conf
          # pwd

      # - name: Setup tmate session
      #   uses: mxschmitt/action-tmate@v3
      - run: |
          mkdir nightly/test
          ls -lra nightly